{
  "hash": "9d2359a53c623df3db0eaf44c96cce29",
  "result": {
    "markdown": "---\ntitle: \"Day 1 - Building a Performance Measure Case\"\nformat: html\n---\n\n\n# Introduction\n\nToday's complex business environment demands tools that offer both versatility and precision. In this session, we'll explore three vital financial tasks using the R programming environment:\n\n1.  **Cost Allocation:** Get a granular understanding of how costs disperse across products, emphasizing the allocation of indirect costs.\n\n2.  **Contribution Margin Analysis:** Examine the profitability of individual products, distinguishing which products significantly impact the bottom line.\n\n3.  **Monte-Carlo Analysis:** Navigate business uncertainties with this statistical technique, utilizing random sampling to achieve numerical results for multifaceted problems.\n\nBut why opt for R over mainstream tools like Excel?\n\n**The Case for R:**\n\n-   **Reproducibility:** With R scripts, analyses can be reproduced and validated effortlessly. This is invaluable for audits or simply revisiting your work months or years later.\n\n-   **Handling Large Data sets:** R is equipped to manage extensive datasets, something Excel struggles with beyond a point.\n\n-   **Flexibility:** R's vast array of packages and its ability to integrate with other languages and tools make it highly adaptable.\n\n-   **Advanced Statistical Analysis:** While Excel offers basic statistical tools, R provides a comprehensive suite for sophisticated analyses.\n\n-   **Cost-Effective:** Being open-source, R is freely available, ensuring businesses don't incur additional software costs.\n\nBy the session's end, you'll appreciate not just the theoretical aspects of these techniques but also the practical advantages of implementing them in an open-source environment like R.\n\nLet's get started!\n\n# Loading Libraries\n\nIn this session, we'll be leveraging various R libraries, each catering to specific tasks and functionalities. Here's a breakdown of the libraries and their primary uses:\n\n**Data Manipulation and Visualization**\n\n-   **`tidyverse`**: A collection of packages tailored for data science.\n\n    -   Includes **`dplyr`** for data manipulation, **`ggplot2`** for data visualization, **`readr`** for reading data, among others.\n\n-   **`janitor`**: Useful for cleaning data and performing some basic data wrangling tasks.\n\n**Data I/O**\n\n-   **`openxlsx`**: Specifically designed for reading from and writing to Excel sheets.\n\n**Numeric and Statistical Functions**\n\n-   **`scales`**: Aids in formatting numbers, especially for data visualization purposes.\n\n-   **`furrr`**: An offshoot of the **`purrr`** package, **`furrr`** makes it easy to apply functions in parallel.\n\n**Themes and Visualization Enhancements**\n\n-   **`ggthemes`**: Provides additional themes and scales for **`ggplot2`**, enhancing the aesthetics and readability of plots.\n\n**Miscellaneous**\n\n-   **`tictoc`**: Helps in measuring the time taken for code execution, useful for performance tuning.\n\n**Custom Functions**\n\n-   **`source(\"additional_functions.R\")`**: Loads user-defined functions from an external R script.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(openxlsx)\nlibrary(janitor)\nlibrary(scales)\nlibrary(tictoc)\nlibrary(furrr)\nlibrary(ggthemes)\nlibrary(gt)\nlibrary(fst)\nlibrary(future)\n\noptions(scipen = 999)\nsource(\"additional_functions.R\")\nsc <- scales::comma\n```\n:::\n\n\n# The Use Case\n\n![Cost Overview](/img/CostOverview.png)\n\n![Cost Allocation](/img/CostAllocation.png)\n\n# Cost Allocation\n\n## Task 1: Allocate Indirect Cost\n\nWe know that we have to allocate indirect costs onto the individual product. Let's tale Material Cost as an example:\n\n-   Direct Cost Elite (DC~1~): 30,000 €\n\n-   Direct Cost Premium (DC~2~): 70,000 €\n\n-   Indirect Cost (IC): 40,000\n\nThe general Formula for allocating indirect Cost is:\n\n$$\nIC_{c,i} = IC_{c}*\\frac{DC_{c,i}}{\\sum_{i} DC_i}\n$$\n\n### Task 1A: Material Cost Allocation Preparation\n\nUse the given data to calculate the cost allocation:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmat_dic <- c(\"Elite\" = 30000, \"Premium\" = 70000)\nmat_inc <- 40000\n```\n:::\n\n\n**ToDo: Calculate the correct value for mat_ac**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmat_alc <- NULL # YOUR CALCULATION HERE\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n  Elite Premium \n  12000   28000 \n```\n:::\n:::\n\n\nCheck Your Result\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_named_vector(mat_alc, c(\"Elite\" = 12000, \"Premium\" = 28000))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSuccess: Correct Values and Names\n```\n:::\n:::\n\n\n### Task 1B: Write a general cost allocation formula\n\nEnsure the function only accepts named numeric vectors.\n\nName conventions: `.m_dic` for the direct cost vector, and `.s_inc` for the indirect cost (**m\\_** stands for multiple values and **s\\_** stands for single values).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nallocate_indirect_cost <- function(.m_dic, .s_inc) {\n  # YOUR CODE HERE\n}\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmat_alc <- allocate_indirect_cost(mat_dic, mat_inc)\n```\n:::\n\n\nCheck Your Result\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_named_vector(mat_alc, c(\"Elite\" = 12000, \"Premium\" = 28000))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSuccess: Correct Values and Names\n```\n:::\n:::\n\n\n## Task 2: Summing Cost Vectors\n\nThe goal here is to devise a formula that can take multiple named numeric vectors as its input and return a new vector whose elements are the piece-wise sum of the elements in the input vectors. This formula will allow you to combine, for example, direct costs and allocated indirect costs to derive the total costs.\n\n### Task 2A: Cost Summation Formula\n\nYou aim to create a function, **`sum_cost`**, that can receive any number of named numeric vectors and return their piece-wise sum.\n\nThe two common methods in R to handle an arbitrary number of function inputs are:\n\n1.  **Using a list**: Each vector is considered an item in the list. This method is more structured but requires each vector to be manually added to the list.\n\n2.  **Using the `...` operator**: This is a placeholder for any number of arguments that can be passed to a function. It provides flexibility because you don't have to specify in advance how many arguments you're going to use. Later, inside the function, you can convert **`...`** to a list using the **`list(...)`** function, allowing you to manipulate the arguments as a single list object.\n\nGiven these methods, here's how you can create the **`sum_cost`** function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum_cost <- function(...) {\n  # YOUR CODE HERE\n}\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmat_tot <- sum_cost(mat_dic, mat_inc )\n```\n:::\n\n\nCheck Your Result\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_named_vector(mat_tot, c(\"Elite\" = 70000, \"Premium\" = 110000))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSuccess: Correct Values and Names\n```\n:::\n:::\n\n\n## Task 3: Using Real Data for Cost Allocation\n\nTo understand and compute the cost allocation using the lecture data, we'll extract it from an Excel sheet and perform specific operations based on the data's structure.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_cost <- tibble::as_tibble(\n  openxlsx::read.xlsx(\"../Business Case.xlsx\", \"Cost1\")\n  ) %>%\n  janitor::clean_names()\ntab_cost\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 9 x 6\n  type     product department    amount distr   range_std\n  <chr>    <chr>   <chr>          <dbl> <chr>       <dbl>\n1 Direct   Elite   Material       30000 normal       5000\n2 Direct   Premium Material       70000 normal       7500\n3 Indirect <NA>    Material       40000 uniform      5000\n4 Direct   Elite   Manufacturing  40000 normal       2500\n5 Direct   Premium Manufacturing  50000 normal       1500\n6 Indirect <NA>    Manufacturing 135000 uniform     25000\n7 Indirect <NA>    Admin          73000 uniform      7500\n8 Indirect <NA>    Marketing      36500 uniform      3750\n9 Company  <NA>    <NA>           30000 uniform     22500\n```\n:::\n:::\n\n\nHere, we use the **`openxlsx`** package to read the specific sheet \"Cost1\" from the Excel file. This data is then converted into a **`tibble`** (a modern form of R's data frame) for easier manipulation. The **`clean_names()`** function from the **`janitor`** package is used to ensure our column names are consistent and easy to work with.\n\n### Task 3A: Writing a formula to read product cost\n\n**Objective**: For this task, your goal is to write a function named **`filter_cost_input`** that filters the data for a specific cost type (e.g., Direct or Indirect) and a specific department (e.g., Material, Manufacturing). This function should return a named numeric vector where names are products, and values are the associated costs.\n\n**YOUR FUNCTION**:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfilter_cost_input <- function(.tab, .type, .dep) {\n  # YOUR CODE HERE\n}\n```\n:::\n\n\n**Instructions**:\n\n1.  Use the **`filter()`** function from the **`dplyr`** package to filter the table based on the given cost type and department.\n\n2.  After filtering, arrange the results based on the product name. This will ensure consistency in later steps.\n\n3.  Now, you'll need to generate a named vector from the filtered results. This can be achieved using the **`mutate()`** function to set the names of the **`amount`** column to be the respective product names.\n\n4.  Finally, extract just the named **`amount`** vector using the **`pull()`** function.\n\n\n::: {.cell}\n\n:::\n\n\nCheck Your Result\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmat_dic <- filter_cost_input(tab_cost, \"Direct\", \"Material\")\nmat_dic\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Elite Premium \n  30000   70000 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_named_vector(mat_dic, c(\"Elite\" = 30000, \"Premium\" = 70000))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSuccess: Correct Values and Names\n```\n:::\n:::\n\n\n### Task 3B: Writing formulas to get Cost Allocation List\n\n**Objective**: The aim of this exercise is to calculate different types of costs, both direct and indirect, and allocate them properly across products.\n\n**Step-by-Step Guide:**\n\n1.  **Understand the Structure**: The **`get_cost_allocations`** function will compute various costs and store them in a list. This list will help organize and categorize costs according to their type and department.\n\n2.  **Material Costs**:\n\n    -   **Direct Material Cost (`mat_dic`)**: This is already computed for you using the **`filter_cost_input`** function. It represents the costs directly linked to materials for each product.\n\n    -   **Indirect Material Cost (`mat_inc`)**: These costs are associated with materials but can't be linked to a specific product. Instead, they're spread out across all products.\n\n    -   **Allocated Material Cost (`mat_alc`)**: Here, you need to allocate the indirect material cost across all products based on some allocation rule (like proportion of direct costs or units produced). Use the **`allocate_indirect_cost`** function with **`mat_dic`** and **`mat_inc`** as arguments.\n\n    -   **Total Material Cost (`mat_tot`)**: This is the sum of direct material cost and allocated indirect material cost. Use the **`sum_cost`** function.\n\n3.  **Manufacturing Costs**:\n\n    -   **Direct Manufacturing Cost (`man_dic`)** and **Indirect Manufacturing Cost (`man_inc`)**: These are computed in a manner similar to material costs.\n\n    -   **Allocated Manufacturing Cost (`man_alc`)**: Allocate the indirect manufacturing cost across products. Consider factors like machine hours or labor hours if relevant.\n\n    -   **Total Manufacturing Cost (`man_tot`)**: Sum up the direct and allocated indirect manufacturing costs.\n\n4.  **Administrative Costs**:\n\n    -   **Indirect Admin Cost (`adm_inc`)**: As administrative costs are often indirect, allocate these across products based on a suitable allocation base (e.g., total costs or sales).\n\n    -   **Allocated Admin Cost (`adm_alc`)**: Spread the indirect admin cost using an appropriate rule.\n\n5.  **Marketing Costs**:\n\n    -   **Indirect Marketing Cost (`mar_inc`)**: These are the costs associated with marketing activities that can't be directly linked to a product.\n\n    -   **Allocated Marketing Cost (`mar_alc`)**: Distribute the marketing costs among products.\n\n6.  **Total Product Cost (`prd_tot`)**: This is a summation of all costs associated with a product - material, manufacturing, administrative, and marketing. Ensure all costs are considered, both direct and allocated indirect.\n\nUse the Functions `allocate_indirect_cost()` and `sum_cost()` to complete the `get_cost_allocations()` functions\n\n**YOUR FUNCTION**:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_cost_allocations <- function(.tab_cost) {\n  # Create an empty list to store values\n  lst_ <- list()\n\n  # Material Cost\n  lst_[[\"mat_dic\"]] <- filter_cost_input(.tab_cost, \"Direct\", \"Material\")   # Direct Material Cost\n  lst_[[\"mat_inc\"]] <- filter_cost_input(.tab_cost, \"Indirect\", \"Material\") # Indirect Material Cost\n  lst_[[\"mat_alc\"]] <- NULL # YOUR CODE HERE                                # Allocated Material Cost\n  lst_[[\"mat_tot\"]] <- NULL # YOUR CODE HERE                                # Total Material Cost\n\n  # Manufacturing Cost\n  lst_[[\"man_dic\"]] <- filter_cost_input(.tab_cost, \"Direct\", \"Manufacturing\")   # Direct Manufacturing Cost\n  lst_[[\"man_inc\"]] <- filter_cost_input(.tab_cost, \"Indirect\", \"Manufacturing\") # Indirect Manufacturing Cost\n  lst_[[\"man_alc\"]] <- NULL # YOUR CODE HERE                                     # Allocated Manufacturing Cost\n  lst_[[\"man_tot\"]] <- NULL # YOUR CODE HERE                                     # Total Manufacturing Cost\n\n  # Administrative Cost\n  lst_[[\"adm_inc\"]] <- filter_cost_input(.tab_cost, \"Indirect\", \"Admin\") # Indirect Admin Cost\n  lst_[[\"adm_alc\"]] <- NULL # YOUR CODE HERE                             # Allocated Admin Cost\n\n  # Marketing Cost\n  lst_[[\"mar_inc\"]] <- filter_cost_input(.tab_cost, \"Indirect\", \"Marketing\") # Indirect Marketing Cost\n  lst_[[\"mar_alc\"]] <- NULL # YOUR CODE HERE                                 # Allocated Marketing Cost\n\n  # Total Product Cost\n  lst_[[\"prd_tot\"]] <- NULL # YOUR CODE HERE\n\n  return(lst_)\n}\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n**Function Breakdown:**\n\n1.  **Function Name**: **`get_cost_allocation_skeleton`**\n\n    -   This name suggests that we are fetching or creating a foundational structure for our cost allocations.\n\n2.  **The `tibble::tribble` Function**:\n\n    -   This function is from the **`tibble`** package and helps in creating a small table (or tibble) in a readable form.\n\n    -   The **`~sign`** and **`~var`** are column names in this table. Each subsequent line in the function provides a row of data for these columns.\n\n**Usage:**\n\nWhen you call the function, it returns the described tibble structure. This \"skeleton\" serves as a roadmap for allocating and tallying up various costs. As you proceed with the exercise, you will populate this table with actual monetary values corresponding to each cost type. This visual representation helps in comprehending the flow and accumulation of different cost components.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_cost_allocation_skeleton <- function() {\n  tibble::tribble(\n    ~sign, ~var,\n    \" \", \"Direct Material Costs\",\n    \"+\", \"Indirect Material Costs\",\n    \"=\", \"Material Costs\",\n    \"+\", \"Direct Manufacturing Costs\",\n    \"+\", \"Indirect Manufacturing Costs\",\n    \"=\", \"Manufacturing Costs\",\n    \"+\", \"Indirect Administration Costs\",\n    \"+\", \"Indirect Marketing Costs\",\n    \"=\", \"Total Product Costs\"\n  )\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nget_cost_allocation_skeleton()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 9 x 2\n  sign  var                          \n  <chr> <chr>                        \n1 \" \"   Direct Material Costs        \n2 \"+\"   Indirect Material Costs      \n3 \"=\"   Material Costs               \n4 \"+\"   Direct Manufacturing Costs   \n5 \"+\"   Indirect Manufacturing Costs \n6 \"=\"   Manufacturing Costs          \n7 \"+\"   Indirect Administration Costs\n8 \"+\"   Indirect Marketing Costs     \n9 \"=\"   Total Product Costs          \n```\n:::\n:::\n\n\n### Task 3C: Display Cost Allocation Table\n\nIn this task, your goal is to use the pre-defined functions **`get_cost_allocation_list()`** and **`get_cost_allocation_skeleton()`** to construct the final Cost Allocation Table.\n\nThe Cost Allocation Table is crucial because it breaks down both direct and indirect costs, allowing a company to understand its cost structure better. By the end of this task, you should be able to represent all these costs in a well-organized table.\n\n**Instructions:**\n\n1.  **Understanding the Skeleton**:\n\n    -   Before jumping into building the entire table, let's familiarize ourselves with the **`get_cost_allocation_skeleton()`** function. This function provides a structured, step-by-step representation of how costs are compiled. Each row of the output represents either an individual cost or a summation.\n\n    -   Try running the function by itself to see its output!\n\n2.  **Fetching the Costs**:\n\n    -   The **`get_cost_allocation_list()`** function is designed to extract various types of costs from the dataset. It returns a list containing costs categorized by their type (direct, indirect) and nature (material, manufacturing, etc.).\n\n    -   For the purpose of this task, run the function with your dataset and examine its output. Familiarize yourself with the different types of costs it provides.\n\n3.  **Building the Table**:\n\n    -   Your main challenge is to construct the Cost Allocation Table. This will involve integrating the structure provided by the skeleton with the actual cost data.\n\n    -   Think of how you can combine the structured format of the skeleton with the actual cost numbers. You'll need to fetch each relevant cost from the list and place it in the correct position within the table.\n\n    -   Note: The skeleton uses signs like \"+\" and \"=\" to signify addition and summation. This can guide you on where and how to place and calculate costs.\n\n4.  **Steps to Consider for the Function**:\n\n    -   Start by fetching the costs using **`get_cost_allocation_list()`**.\n\n    -   Use the output of **`get_cost_allocation_skeleton()`** as your foundational table.\n\n    -   For each line in the skeleton, fetch the corresponding cost from your list and append it as a new column to the table.\n\n    -   Once you've placed all the individual costs, think about the rows that require summation (those with \"=\"). Calculate these using the appropriate rows.\n\n    -   Continue this process until you've constructed the entire table.\n\n    -   Add a Total Column to the Table that shows the total cost over all Products\n\n5.  **Testing**:\n\n    -   Once you've written your function, test it with the given data. Your output should align with the structure of the skeleton and display all the relevant costs.\n\n**Tips:**\n\n-   Remember, you're not starting from scratch! You have a structured format and categorized data. It's all about bringing them together in the right order.\n\n-   The use of functions from packages like **`dplyr`** and **`purrr`** can significantly simplify data manipulation and transformation. If you're familiar with these, consider how they can assist in your task.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_cost_allocation_table <- function(.tab_cost) {\n  # YOUR CODE HERE\n}\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nget_cost_allocation_table(.tab_cost = tab_cost)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 9 x 5\n  sign  var                            Total  Elite Premium\n  <chr> <chr>                          <dbl>  <dbl>   <dbl>\n1 \" \"   Direct Material Costs         100000  30000   70000\n2 \"+\"   Indirect Material Costs        40000  12000   28000\n3 \"=\"   Material Costs                140000  42000   98000\n4 \"+\"   Direct Manufacturing Costs     90000  40000   50000\n5 \"+\"   Indirect Manufacturing Costs  135000  60000   75000\n6 \"=\"   Manufacturing Costs           365000 142000  223000\n7 \"+\"   Indirect Administration Costs  73000  28400   44600\n8 \"+\"   Indirect Marketing Costs       36500  14200   22300\n9 \"=\"   Total Product Costs           474500 184600  289900\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nformat_table(get_cost_allocation_table(tab_cost))\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"fjvedwqjil\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#fjvedwqjil table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#fjvedwqjil thead, #fjvedwqjil tbody, #fjvedwqjil tfoot, #fjvedwqjil tr, #fjvedwqjil td, #fjvedwqjil th {\n  border-style: none;\n}\n\n#fjvedwqjil p {\n  margin: 0;\n  padding: 0;\n}\n\n#fjvedwqjil .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#fjvedwqjil .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#fjvedwqjil .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#fjvedwqjil .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#fjvedwqjil .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fjvedwqjil .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fjvedwqjil .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fjvedwqjil .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#fjvedwqjil .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#fjvedwqjil .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#fjvedwqjil .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#fjvedwqjil .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#fjvedwqjil .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#fjvedwqjil .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#fjvedwqjil .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#fjvedwqjil .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#fjvedwqjil .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#fjvedwqjil .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#fjvedwqjil .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fjvedwqjil .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#fjvedwqjil .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#fjvedwqjil .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#fjvedwqjil .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fjvedwqjil .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#fjvedwqjil .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#fjvedwqjil .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fjvedwqjil .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fjvedwqjil .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#fjvedwqjil .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fjvedwqjil .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#fjvedwqjil .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fjvedwqjil .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fjvedwqjil .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fjvedwqjil .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fjvedwqjil .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fjvedwqjil .gt_left {\n  text-align: left;\n}\n\n#fjvedwqjil .gt_center {\n  text-align: center;\n}\n\n#fjvedwqjil .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#fjvedwqjil .gt_font_normal {\n  font-weight: normal;\n}\n\n#fjvedwqjil .gt_font_bold {\n  font-weight: bold;\n}\n\n#fjvedwqjil .gt_font_italic {\n  font-style: italic;\n}\n\n#fjvedwqjil .gt_super {\n  font-size: 65%;\n}\n\n#fjvedwqjil .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#fjvedwqjil .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#fjvedwqjil .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#fjvedwqjil .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#fjvedwqjil .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#fjvedwqjil .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#fjvedwqjil .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"sign\">sign</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"var\">var</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"Total\">Total</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"Elite\">Elite</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"Premium\">Premium</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\"> </td>\n<td headers=\"var\" class=\"gt_row gt_left\">Direct Material Costs</td>\n<td headers=\"Total\" class=\"gt_row gt_right\">100,000</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\">30,000</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\">70,000</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\">+</td>\n<td headers=\"var\" class=\"gt_row gt_left\">Indirect Material Costs</td>\n<td headers=\"Total\" class=\"gt_row gt_right\">40,000</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\">12,000</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\">28,000</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">=</td>\n<td headers=\"var\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Material Costs</td>\n<td headers=\"Total\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">140,000</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">42,000</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">98,000</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\">+</td>\n<td headers=\"var\" class=\"gt_row gt_left\">Direct Manufacturing Costs</td>\n<td headers=\"Total\" class=\"gt_row gt_right\">90,000</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\">40,000</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\">50,000</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\">+</td>\n<td headers=\"var\" class=\"gt_row gt_left\">Indirect Manufacturing Costs</td>\n<td headers=\"Total\" class=\"gt_row gt_right\">135,000</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\">60,000</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\">75,000</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">=</td>\n<td headers=\"var\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Manufacturing Costs</td>\n<td headers=\"Total\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">365,000</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">142,000</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">223,000</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\">+</td>\n<td headers=\"var\" class=\"gt_row gt_left\">Indirect Administration Costs</td>\n<td headers=\"Total\" class=\"gt_row gt_right\">73,000</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\">28,400</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\">44,600</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\">+</td>\n<td headers=\"var\" class=\"gt_row gt_left\">Indirect Marketing Costs</td>\n<td headers=\"Total\" class=\"gt_row gt_right\">36,500</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\">14,200</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\">22,300</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">=</td>\n<td headers=\"var\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Total Product Costs</td>\n<td headers=\"Total\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">474,500</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">184,600</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">289,900</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n# Contribution Margin\n\nHaving the cost allocation ready, we no focus on performance measures, namely the contribution margin. Looking at the Contribution margin table we see that we now need another function, namely where we have one positive input value (e.g. revenue) and subtract a cost element (e.g. Variable Cost)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_revenue <- tibble::as_tibble(\n  openxlsx::read.xlsx(\"../Business Case.xlsx\", \"Revenue1\")\n  ) %>%\n  janitor::clean_names()\ntab_revenue\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 x 6\n  product units price amount distr  range_std\n  <chr>   <dbl> <dbl>  <dbl> <chr>      <dbl>\n1 Elite     500   350 175000 normal     25000\n2 Premium   500   600 300000 normal     30000\n```\n:::\n:::\n\n\n## Task 4A: Subtracting Cost Vectors for Revenue Vectors\n\nYou aim to create a function, **`substract_cost`**, that can receive any number of named numeric vectors and subtract values from the first value.\n\nThe two common methods in R to handle an arbitrary number of function inputs are:\n\n1.  **Using a list**: Each vector is considered an item in the list. This method is more structured but requires each vector to be manually added to the list.\n\n2.  **Using the `...` operator**: This is a placeholder for any number of arguments that can be passed to a function. It provides flexibility because you don't have to specify in advance how many arguments you're going to use. Later, inside the function, you can convert **`...`** to a list using the **`list(...)`** function, allowing you to manipulate the arguments as a single list object.\n\nGiven these methods, here's how you can create the **`substract_cost`** function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsubtract_cost <- function(...) {\n  # YOUR CODE HERE\n}\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nCheck Your Result\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrevenues <- c(\"Elite\" = 100000, \"Premium\" = 250000)\nvar_cost <- c(\"Elite\" = 70000, \"Premium\" = 120000)\n\ncm1 <- subtract_cost(revenues, var_cost)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_named_vector(cm1, c(\"Elite\" = 30000, \"Premium\" = 130000))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSuccess: Correct Values and Names\n```\n:::\n:::\n\n\n## Task 4B: Writing a formula to read product revenues\n\n**Objective**: For this task, your goal is to write a function named **`filter_revenue_input`** This function should return a named numeric vector where names are products, and values are the associated costs.\n\n**YOUR FUNCTION**:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfilter_revenue_input <- function(.tab, .type, .dep) {\n  # YOUR CODE HERE\n}\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfilter_revenue_input(tab_revenue)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Elite Premium \n 175000  300000 \n```\n:::\n:::\n\n\n## Task 4C: Writing formulas to get Contribution Margin List\n\nRemember Task 3B. Use the Functions `subtract_cost()` and `sum_cost()` to complete the `get_cost_allocations_and_list()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_cost_allocation_and_cm_list <- function(.tab_cost, .tab_revenue) {\n  lst_cost_ <- get_cost_allocation_list(.tab_cost) # The Cost Allocation List\n  lst_cm_   <- list() # A new List for Contribution Margin\n\n  lst_cm_[[\"revenues\"]] <- filter_revenue_input(.tab_revenue) # Revenues\n  lst_cm_[[\"var_cost\"]] <- NULL # YOUR CODE HERE    \n  lst_cm_[[\"cm1\"]]      <- NULL # YOUR CODE HERE    \n  lst_cm_[[\"fix_cost\"]] <- NULL # YOUR CODE HERE    \n  lst_cm_[[\"cm2\"]]      <- NULL # YOUR CODE HERE    \n  \n  return(c(lst_cost_, lst_cm_)) # Return the combined list\n}\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n## Task 4D: Display Contribution Margin Table\n\nRemember Task 3C.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_contribution_margin_skeleton <- function() {\n  tibble::tribble(\n    ~sign, ~var,\n    \" \", \"Revenue\",\n    \"-\", \"Variable Cost\",\n    \"=\", \"Contribution Margin 1\",\n    \"-\", \"Product Fix Cost\",\n    \"=\", \"Contribution Margin 2\",\n  )\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmake_cm_table <- function(.tab_cost, .tab_revenue) {\n  # YOUR CODE HERE\n}\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nformat_table(make_cm_table(tab_cost, tab_revenue))\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"brbwewvpaj\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#brbwewvpaj table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#brbwewvpaj thead, #brbwewvpaj tbody, #brbwewvpaj tfoot, #brbwewvpaj tr, #brbwewvpaj td, #brbwewvpaj th {\n  border-style: none;\n}\n\n#brbwewvpaj p {\n  margin: 0;\n  padding: 0;\n}\n\n#brbwewvpaj .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#brbwewvpaj .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#brbwewvpaj .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#brbwewvpaj .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#brbwewvpaj .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#brbwewvpaj .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#brbwewvpaj .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#brbwewvpaj .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#brbwewvpaj .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#brbwewvpaj .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#brbwewvpaj .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#brbwewvpaj .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#brbwewvpaj .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#brbwewvpaj .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#brbwewvpaj .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#brbwewvpaj .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#brbwewvpaj .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#brbwewvpaj .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#brbwewvpaj .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#brbwewvpaj .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#brbwewvpaj .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#brbwewvpaj .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#brbwewvpaj .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#brbwewvpaj .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#brbwewvpaj .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#brbwewvpaj .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#brbwewvpaj .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#brbwewvpaj .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#brbwewvpaj .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#brbwewvpaj .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#brbwewvpaj .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#brbwewvpaj .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#brbwewvpaj .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#brbwewvpaj .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#brbwewvpaj .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#brbwewvpaj .gt_left {\n  text-align: left;\n}\n\n#brbwewvpaj .gt_center {\n  text-align: center;\n}\n\n#brbwewvpaj .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#brbwewvpaj .gt_font_normal {\n  font-weight: normal;\n}\n\n#brbwewvpaj .gt_font_bold {\n  font-weight: bold;\n}\n\n#brbwewvpaj .gt_font_italic {\n  font-style: italic;\n}\n\n#brbwewvpaj .gt_super {\n  font-size: 65%;\n}\n\n#brbwewvpaj .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#brbwewvpaj .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#brbwewvpaj .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#brbwewvpaj .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#brbwewvpaj .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#brbwewvpaj .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#brbwewvpaj .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"sign\">sign</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"var\">var</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"Total\">Total</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"Elite\">Elite</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"Premium\">Premium</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\"> </td>\n<td headers=\"var\" class=\"gt_row gt_left\">Revenue</td>\n<td headers=\"Total\" class=\"gt_row gt_right\">475,000</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\">175,000</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\">300,000</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\">-</td>\n<td headers=\"var\" class=\"gt_row gt_left\">Variable Cost</td>\n<td headers=\"Total\" class=\"gt_row gt_right\">190,000</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\">70,000</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\">120,000</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">=</td>\n<td headers=\"var\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Contribution Margin 1</td>\n<td headers=\"Total\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">285,000</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">105,000</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">180,000</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\">-</td>\n<td headers=\"var\" class=\"gt_row gt_left\">Product Fix Cost</td>\n<td headers=\"Total\" class=\"gt_row gt_right\">284,500</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\">114,600</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\">169,900</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">=</td>\n<td headers=\"var\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Contribution Margin 2</td>\n<td headers=\"Total\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">500</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\" style=\"font-weight: bold; color: #FF0000;\">(9,600)</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">10,100</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n# Monte Carlo Analysis\n\n**Introduction:**\n\nMonte Carlo Analysis is a powerful statistical technique that allows you to account for uncertainty in your decision-making processes. It allows you to model possible outcomes by randomizing specific inputs according to predefined distributions. This approach is named after the city of Monte Carlo, known for its casinos, suggesting the element of chance or randomness.\n\nIn our context, we'll be performing a Monte Carlo Analysis to simulate the effects of various inputs on our outcome variable: the contribution margin. This is a critical tool in finance and business strategy, allowing for a deeper understanding of potential variability in key metrics.\n\n**Description:**\n\n1.  **Randomizing Input**:\n\n    -   The **`randomize_input`** function allows us to randomize a given input based on either a normal or uniform distribution. The randomness is controlled by the seed, ensuring reproducibility.\n\n        -   **`.distr`**: The distribution type. Can be either \"normal\" or \"uniform\".\n\n        -   **`.mean`**: The central tendency of your distribution.\n\n        -   **`.bound`**: For the normal distribution, it's the standard deviation. For the uniform distribution, it's the range around the mean.\n\n        -   **`.seed`**: Seed for reproducibility.\n\n2.  **Randomizing Input Table**:\n\n    -   The **`randomize_input_table`** function is an extension of the **`randomize_input`** function but applies the randomness over an entire table.\n\n        -   **`.tab`**: The table you want to randomize.\n\n        -   **`.seed`**: Seed for reproducibility.\n\n3.  **Test Random Functions**:\n\n    -   In the given scripts, there's a small test showing how to randomize inputs for both single values and entire tables.\n\n4.  **Contribution Margin Table**:\n\n    -   The **`make_cm_table`** function computes the contribution margin table by randomizing the cost and revenue tables.\n\n5.  **Running Monte Carlo Simulation**:\n\n    -   Monte Carlo Simulations involve repeating the randomization process multiple times and observing the resulting outcomes.\n\n        -   We use the **`purrr::map`** function to run the **`get_cost_allocation_and_cm`** function multiple times.\n\n        -   The simulation is repeated 100 times, with a different seed each time to ensure variability.\n\n        -   We use the **`tictoc`** package to measure how long the entire simulation process takes. This can be useful to understand the computational complexity.\n\n6.  **Parallel Processing**:\n\n    -   To speed up the Monte Carlo simulations, we leverage the power of parallel processing. This means that multiple computations run simultaneously.\n\n        -   **`future::availableCores()`**: Determines the number of available processing cores.\n\n        -   **`furrr::future_map`**: A function from the **`furrr`** package that allows for parallel processing. This drastically reduces the time needed for simulations when you have multiple cores available.\n\n7.  **Visualization**:\n\n    -   Once the simulation is done, it's time to visualize the outcomes.\n\n        -   The **`display_histogram`** function is used to provide a histogram of the contribution margin's possible values. This gives a visual representation of the most likely values, the variability, and the possible range of the contribution margin.\n\n**Key Takeaways:**\n\n-   Monte Carlo Analysis helps in understanding the potential range and variability of financial outcomes.\n\n-   It emphasizes not only focusing on the most likely outcome but also considering a range of possible outcomes.\n\n-   Parallel processing can speed up the process significantly, especially when dealing with a large number of simulations.\n\n-   Visualization tools, such as histograms, offer a succinct way to interpret the results of Monte Carlo Analysis.\n\nRemember, while Monte Carlo Analysis provides a range of outcomes, it doesn't predict the future. Instead, it offers a probabilistic view of potential outcomes based on the variability of the inputs. It's an essential tool for risk analysis, helping businesses prepare for a range of scenarios.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrandomize_input <- function(.distr, .mean, .bound, .seed) {\n  set.seed(.seed)\n  if (.distr == \"normal\") {\n    rnorm(1, .mean, .bound)\n  } else if (.distr == \"uniform\") {\n    runif(1, .mean - .bound, .mean + .bound)\n  } else {\n    stop(\"Wrong Distribution Specified\")\n  }\n}\n\nrandomize_input_table <- function(.tab, .seed) {\n  .tab %>%\n    dplyr::mutate(\n      amount = purrr::pmap_dbl(\n        .l = list(distr, amount, range_std), \n        .f = ~ randomize_input(..1, ..2, ..3, .seed)\n        )) %>%\n    dplyr::mutate(amount = purrr::set_names(amount, product))\n}\n\n\n\nrandomize_input(tab_cost$distr[1], tab_cost$amount[1], tab_cost$range_std[1], 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 26867.73\n```\n:::\n\n```{.r .cell-code}\nrandomize_input_table(.tab = tab_revenue, 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 x 6\n  product units price  amount distr  range_std\n  <chr>   <dbl> <dbl>   <dbl> <chr>      <dbl>\n1 Elite     500   350 152577. normal     25000\n2 Premium   500   600 273093. normal     30000\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmake_cm_table(\n  .tab_cost = randomize_input_table(tab_cost, 2), \n  .tab_revenue = randomize_input_table(tab_revenue, 2)\n  ) %>%  format_table()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"ffhqqlirka\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ffhqqlirka table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ffhqqlirka thead, #ffhqqlirka tbody, #ffhqqlirka tfoot, #ffhqqlirka tr, #ffhqqlirka td, #ffhqqlirka th {\n  border-style: none;\n}\n\n#ffhqqlirka p {\n  margin: 0;\n  padding: 0;\n}\n\n#ffhqqlirka .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ffhqqlirka .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ffhqqlirka .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ffhqqlirka .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ffhqqlirka .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ffhqqlirka .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ffhqqlirka .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ffhqqlirka .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ffhqqlirka .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ffhqqlirka .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ffhqqlirka .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ffhqqlirka .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ffhqqlirka .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ffhqqlirka .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ffhqqlirka .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ffhqqlirka .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ffhqqlirka .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ffhqqlirka .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ffhqqlirka .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ffhqqlirka .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ffhqqlirka .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ffhqqlirka .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ffhqqlirka .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ffhqqlirka .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ffhqqlirka .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ffhqqlirka .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ffhqqlirka .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ffhqqlirka .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ffhqqlirka .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ffhqqlirka .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ffhqqlirka .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ffhqqlirka .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ffhqqlirka .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ffhqqlirka .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ffhqqlirka .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ffhqqlirka .gt_left {\n  text-align: left;\n}\n\n#ffhqqlirka .gt_center {\n  text-align: center;\n}\n\n#ffhqqlirka .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ffhqqlirka .gt_font_normal {\n  font-weight: normal;\n}\n\n#ffhqqlirka .gt_font_bold {\n  font-weight: bold;\n}\n\n#ffhqqlirka .gt_font_italic {\n  font-style: italic;\n}\n\n#ffhqqlirka .gt_super {\n  font-size: 65%;\n}\n\n#ffhqqlirka .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ffhqqlirka .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ffhqqlirka .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ffhqqlirka .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ffhqqlirka .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ffhqqlirka .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ffhqqlirka .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"sign\">sign</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"var\">var</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"Total\">Total</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"Elite\">Elite</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"Premium\">Premium</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\"> </td>\n<td headers=\"var\" class=\"gt_row gt_left\">Revenue</td>\n<td headers=\"Total\" class=\"gt_row gt_right\">425,670</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\">152,577</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\">273,093</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\">-</td>\n<td headers=\"var\" class=\"gt_row gt_left\">Variable Cost</td>\n<td headers=\"Total\" class=\"gt_row gt_right\">175,201</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\">63,273</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\">111,928</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">=</td>\n<td headers=\"var\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Contribution Margin 1</td>\n<td headers=\"Total\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">250,469</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">89,304</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">161,165</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\">-</td>\n<td headers=\"var\" class=\"gt_row gt_left\">Product Fix Cost</td>\n<td headers=\"Total\" class=\"gt_row gt_right\">258,503</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\">101,632</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\">156,871</td></tr>\n    <tr><td headers=\"sign\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">=</td>\n<td headers=\"var\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Contribution Margin 2</td>\n<td headers=\"Total\" class=\"gt_row gt_right\" style=\"font-weight: bold; color: #FF0000;\">(8,034)</td>\n<td headers=\"Elite\" class=\"gt_row gt_right\" style=\"font-weight: bold; color: #FF0000;\">(12,328)</td>\n<td headers=\"Premium\" class=\"gt_row gt_right\" style=\"font-weight: bold;\">4,294</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntictoc::tic()\nlst_monte_carlo <- purrr::map(\n  .x = 1:100,\n  .f = ~ get_cost_allocation_and_cm_list(\n    .tab_cost = randomize_input_table(tab_cost, .x),\n    .tab_revenue = randomize_input_table(tab_revenue, .x)\n  ), .progress = TRUE\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n =============================>-   98% |  ETA:  0s\n```\n:::\n\n```{.r .cell-code}\ntictoc::toc()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n3.86 sec elapsed\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncores <- min(20, future::availableCores() - 1)\ntictoc::tic()\nfuture::plan(\"multisession\", workers = cores)\nlst_monte_carlo <- furrr::future_map(\n  .x = 1:10000,\n  .f = ~ get_cost_allocation_and_cm_list(\n    .tab_cost = randomize_input_table(tab_cost, .x),\n    .tab_revenue = randomize_input_table(tab_revenue, .x)\n  ),\n  .progress = TRUE,\n  .options = furrr::furrr_options(seed = TRUE)\n)\nfuture::plan(\"default\")\ntictoc::toc()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n28.09 sec elapsed\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlst_monte_carlo_transposed <- purrr::transpose(lst_monte_carlo)\n\ndisplay_histogram(.lst = lst_monte_carlo_transposed$cm2)\n```\n\n::: {.cell-output-display}\n![](day1_files/figure-html/unnamed-chunk-41-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "day1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}